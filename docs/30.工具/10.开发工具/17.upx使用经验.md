---
title: upx使用经验
date: 2025-03-22 15:35:10
permalink: /dev/513c8b/
categories:
  - 工具
  - 开发工具
tags:
  - upx
  - 压缩
  - 优化
  - 加壳
  - 混淆
  - 壳
  - 不器
  - 不器小窝
---

## 💬 前言

最近算是写完了 `qtps` 的基本商业形态的逻辑，但是 `qtps` 打包后差不多有 `27.4M`，个人觉得这个 `27.4M` 感觉很有点大，所以就准备找一个压缩工具来压缩一下，兜兜转转找到了 `upx`，就直接开始用了，目前算是做一个备忘笔记吧。

<!-- more -->

<InArticleAdsense
    data-ad-client="ca-pub-1725717718088510"
    data-ad-slot="4281148213">
</InArticleAdsense>

## 项目地址

[UPX - the Ultimate Packer for eXecutables](https://github.com/upx/upx)

### `upx` 能做什么

`UPX` 全称是 `Ultimate Packer for eXecutables`，是一个免费、开源、编写、可扩展、高性能的可执行程序打包程序。换句话说一个可执行文件的压缩工具。主要的功能是将可执行的二进制程序、动态链接库和其他的二进制文件压缩为更小的体积，`UPX` 通常可以将文件大小减少 `50% - 70%`。从而减少磁盘空间占用、降低网络传输所需带宽、以及分发成本（`UPX` 创建于 `1996` 年，那时大家都在使用软盘，所以存储空间十分宝贵，也凸显了可执行程序压缩的必要性）。

#### `upx` 优势

- 可靠性： `UPX` 内部维护了一套校验逻辑，对压缩前和解压后的文件进行校验，以保证程序的完整性。
- 安全性： 由于`UPX` 多年来一直是开源项目，因此任何开发者、防病毒软件厂商都能看到 `UPX` 压缩程序内部逻辑并验证安全性。
- 解压速度： 在任何现代机器上，解压速度都超过 `500 MB/秒`。
- 无内存开销： 解压运行压缩后的程序无需额外的内存开销。
- 出色的压缩比： `UPX` 通常比传统的 `Zip` 压缩算法压缩效果更好。使用 `UPX` 可以减小分发文件的大小，从而在网络传输和存储方面节省资源。
- 通用性： 可以打包多种可执行格式，包括 `Windows` 应用程序和 `DLL`、`macOS` 应用程序和 `Linux` 可执行文件。
- 可扩展： `UPX` 良好的代码设计，很容易添加新的可执行文件格式支持和新的压缩算法。


## 安装

### `macOS`

我个人使用的是 `macOS` 系统，所以我使用的是 `brew` 来安装的。

```bash
brew install upx
```

> 注意：目前我发现在 `brew` 上的 `upx` 的版本为：`4.2.4`，而 `GitHub` 上的最新版本为：`5.0.0`

### `other`

其它的系统直接在 [GitHub](https://github.com/upx/upx/releases) 上下载对应的 `upx` 版本即可。

## 使用

### 使用说明

#### 压缩参数

- 默认级别: 通常是一个压缩比和消耗时间的中间选项，如果不指定压缩级别参数，`UPX` 会使用此级别。
- `-1 ~ -9`: `UP`X 提供了 `-1` 到 `-9` 的压缩级别参数。其中 `-1` 表示最低级别的压缩，而 `-9` 表示最高级别的压缩，通常级别越高，压缩比越高（压缩后体积越小），但压缩所需时间也会更长。
- `--brute`: 高级别的压缩选项，类似于 `-9`，但压缩的过程中会使用更多的压缩技巧，可能会导致更长的压缩时间。
- `--ultra-brute`: `UPX` 中最高级别的压缩，使用最激进的压缩算法，尽可能的减小文件大小。需要更长的压缩时间，并且运行时所需的解压时间也会增加。
- `--best`: 使用最佳压缩结果的选项，通常效果等于 `-9` 或者 `--ultra-brute`。
- `--fast`: 使用最快压缩速度的选项，通常效果等于 `-1` 或者 `-2`
- `--lzma`: 使用 `LZMA` 算法进行压缩，可以获得比较高的压缩比，但不会有 `--ultra-brute` 那么激进，且通常比 `-9` 更快。
- `--overlay`: 选项将压缩文件附加到可执行文件的末尾，而不是创建新文件。这可以用于一些特殊用途。
- `--force`: 用于强制压缩，即使 `UPX` 认为此文件不适合压缩。
- `--all-filters`: 尝试所有可用的压缩算法，以尝试找到最佳的压缩组合（个人感觉和默认差不多）。

#### 其它参数

- `-o`: 指定压缩后文件输出的名称，如果不指定则默认覆盖原始文件。
- `--list`: 列出压缩过的文件信息，例如压缩比例、文件大小等。
- `--quiet`: 或 `-q` 选项，使用安静模式，减少输出信息，在批处理或自动化的过程中使用。
- `--verbose`: 或 `-v` 选项，启用详细输出，嫌疑有关压缩进程的详细信息。
- `--test`: 用于测试压缩程序是否能正常的解压缩或运行，不会进行实际的压缩操作。
- `--keep`: 保留原始文件，默认情况下如果不指定输出文件名，则会在压缩结束后删掉原始文件。
- `--threads`: 指定用于压缩的线程数，默认情况下与 `CPU` 核心数量相等。
- `--decompress`： 用于解压还原已经被 `UPX` 压缩的文件。

## 个人常用

```bash
upx --best --lzma ../../output/qtps
```


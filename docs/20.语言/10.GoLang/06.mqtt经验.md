---
title: mqttç»éªŒ
date: 2024-07-25 11:12:24
permalink: /language/go/c50fee/
categories:
  - è¯­è¨€
  - GoLang
tags:
  - GoLang
  - GoLang mqtt
  - GoLang mqtt å­¦ä¹ 
  - GoLang mqtt å®æˆ˜
  - GoLang mqtt V5 å­¦ä¹ 
  - GoLang mqtt V5 å®æˆ˜
  - GoLang mqtt V5 æ•™ç¨‹
  - ä¸å™¨
  - ä¸å™¨å°çª
---

## ğŸˆ ç¼˜èµ·

ç›®å‰è¦å†™ä¸€ä¸ª `MQTT` çš„æ¶ˆè´¹è€…ï¼Œå¥ˆä½•ä¸ä¼šä»¥åŠ `golang` çš„åº“æ›´æ–°çš„ä¹Ÿä¸æ˜¯å¾ˆåŠæ—¶ï¼Œæ‰€ä»¥è®°å½•ä¸€ä¸‹ã€‚å“¦ï¼Œå¯¹äº† `mqtt v5` çš„å†™æ³•çœŸçš„æ˜¯æ“è›‹äº†

<InArticleAdsense
    data-ad-client="ca-pub-1725717718088510"
    data-ad-slot="4281148213">
</InArticleAdsense>

<!-- more -->

## `MQTT`

`MQTT` æ˜¯ä¸€ç§åŸºäºæ ‡å‡†çš„æ¶ˆæ¯ä¼ é€’åè®®æˆ–è§„åˆ™é›†ï¼Œç”¨äºæœºå™¨å¯¹æœºå™¨çš„é€šä¿¡ã€‚

`MQTT` ä¼˜åŠ¿ï¼š

- è½»é‡ã€é«˜æ•ˆ
- å¯æ‰©å±•
- å¯é 
- å®‰å…¨
- è‰¯å¥½çš„æ”¯æŒ

å…¶å® `MQTT` æœ€å¤§ä¼˜ç‚¹åœ¨äºï¼Œå¯ä»¥ä»¥æå°‘çš„ä»£ç å’Œæœ‰é™çš„å¸¦å®½ï¼Œä¸ºè¿æ¥è¿œç¨‹è®¾å¤‡æä¾›å®æ—¶å¯é çš„æ¶ˆæ¯æœåŠ¡ã€‚ä½œä¸ºä¸€ç§ä½å¼€é”€ã€ä½å¸¦å®½å ç”¨çš„å³æ—¶é€šè®¯åè®®ï¼Œä½¿å…¶åœ¨ç‰©è”ç½‘ã€å°å‹è®¾å¤‡ã€ç§»åŠ¨åº”ç”¨ç­‰æ–¹é¢æœ‰è¾ƒå¹¿æ³›çš„åº”ç”¨ã€‚

## `MQTT V5` å®æˆ˜æ•™ç¨‹

> `golang` ä½¿ç”¨ `MQTT V5` æˆ‘ç”¨çš„æ˜¯ **[github.com/eclipse/paho.golang](https://github.com/eclipse/paho.golang)**ï¼Œæ³¨æ„æ˜¯ **`github.com/eclipse/paho.golang`**ï¼Œä¸æ˜¯ `github.com/eclipse/paho.mqtt.golang`ã€‚

### å®‰è£…

``` shell
go get github.com/eclipse/paho.golang
```

### è¿æ¥

<InArticleAdsense
    data-ad-client="ca-pub-1725717718088510"
    data-ad-slot="4281148213">
</InArticleAdsense>

``` go
package mqtt

var (
	Client *autopaho.ConnectionManager
	err    error
)

const (
	// MQTT broker åœ°å€
	brokerURL = "mqtt://192.168.10.50:1883"
	username  = "admin"
	password  = "admin"
)

func init() {
	go NewMqttClient(context.Background())
}

// NewMqttClient å®ä¾‹åŒ–ä¸€ä¸ªmqttå®¢æˆ·ç«¯
/**
 * @params  ctx       ä¸Šä¸‹æ–‡
 * @params  topic     ä¸»é¢˜
 */
func NewMqttClient(ctx context.Context) {
	// å®¢æˆ·ç«¯ ID
	clientID := "1235264" // æ³¨æ„ï¼Œå®¢æˆ·ç«¯idå¿…é¡»å”¯ä¸€
	var serverUrls []*url.URL
	serverUrls = append(serverUrls, mustParseURL(ctx, brokerURL))
	// åˆ›å»ºè¿æ¥é…ç½®
	cliCfg := autopaho.ClientConfig{
		ServerUrls:      serverUrls,
		ConnectUsername: username,
		ConnectPassword: []byte(password),
		ClientConfig: paho.ClientConfig{
			ClientID: fmt.Sprintf("%s-%s", "service", clientID),
		},
	}
	// åˆ›å»ºå®¢æˆ·ç«¯è¿æ¥
	ctx, cancel := context.WithCancel(context.Background())
	defer cancel()
	Client, err = autopaho.NewConnection(ctx, cliCfg)
	if err != nil {
		fmt.Sprintf("è¿æ¥é”™è¯¯: %v", err)
	}
	// ç­‰å¾…è¿æ¥å»ºç«‹
	if err = Client.AwaitConnection(ctx); err != nil {
		fmt.Sprintf("è¿æ¥ç­‰å¾…é”™è¯¯: %v", err)
	}
	fmt.Println("mqttè¿æ¥æˆåŠŸ")
	select {}
}

func mustParseURL(ctx context.Context, s string) *url.URL {
	u, err := url.Parse(s)
	if err != nil {
		glog.Errorf(ctx, "failed to parse url: %s", s)
		return nil
	}
	return u
}
```

### å‘å¸ƒ

``` go
for i := 0; i < 100; i++ {
    mqtt.Publish(context.Background(), "xingcxb_test", fmt.Sprintf("%d+%s", 10, i))
}
```

### è®¢é˜…

``` go
mqtt.SubscribeToTopic(context.Background(), "xingcxb_test")
```

## ç»éªŒ

### é›†ç¾¤è®¢é˜…ä»…æ¶ˆè´¹ä¸€æ¬¡

<InArticleAdsense
    data-ad-client="ca-pub-1725717718088510"
    data-ad-slot="4281148213">
</InArticleAdsense>

è®¢é˜…æ—¶æŒ‡å®š `topic` ä¸º `$share/group/topic`ï¼Œå³å¯å®ç°é›†ç¾¤è®¢é˜…ï¼Œä¸”ä»…æ¶ˆè´¹ä¸€æ¬¡ã€‚

å‘é€çš„æ¶ˆæ¯éœ€æŒ‡å®š `topic` ä¸º `$share/group/topic`ï¼Œå¦åˆ™æ— æ³•æ¥æ”¶åˆ°æ¶ˆæ¯ã€‚

æ³¨æ„ï¼š

1. `$share/group` ä¸ºå›ºå®šæ¨¡å¼
2. `group` ä¸ºé›†ç¾¤ç»„åï¼Œéœ€ä¿è¯é›†ç¾¤ç»„åä¸€è‡´(æˆ‘æš‚æ—¶æ²¡æœ‰æµ‹è¯•æ˜¯å¦å¯ä»¥ä¸ºå…¶ä»–çš„å€¼)
3. `topic` ä¸ºè®¢é˜…çš„ä¸»é¢˜ï¼Œéœ€ä¿è¯è®¢é˜…çš„ä¸»é¢˜ä¸€è‡´
4. `topic` çš„å€¼å¯ä»¥ä¸º `test_a` ä½†ç»å¯¹ä¸è¦å†™æˆ `test/a`ï¼Œä¸ç„¶æ— æ³•æ”¶åˆ°æ¶ˆæ¯

